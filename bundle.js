(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function i(t,i,r){return i&&e(t.prototype,i),r&&e(t,r),t}function r(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function s(t){return s=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},s(t)}function n(t,e){return n=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},n(t,e)}function h(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r,n,h,o=s(t);if(e){var a=s(this).constructor;i=Reflect.construct(o,arguments,a)}else i=o.apply(this,arguments);return r=this,!(n=i)||"object"!=((h=n)&&"undefined"!=typeof Symbol&&h.constructor===Symbol?"symbol":typeof h)&&"function"!=typeof n?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r):n}}var o=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&n(t,e)}(s,e);var r=h(s);function s(e,i){return t(this,s),r.call(this,e+(60*Math.random()-30),i,Math.random(),Math.random(),"rgba(0,0,0,0.2)",10*Math.random()+10)}return i(s,[{key:"draw",value:function(t){t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=this.color,t.fill()}}]),s}(function(){function e(i,s,n,h,o,a){t(this,e),r(this,"markForDeletion",void 0),r(this,"x",void 0),r(this,"y",void 0),r(this,"speedX",void 0),r(this,"speedY",void 0),r(this,"color",void 0),r(this,"size",void 0),this.x=i,this.y=s,this.speedX=n,this.speedY=h,this.color=o,this.size=a,this.markForDeletion=!1}return i(e,[{key:"update",value:function(t){this.x-=this.speedX+t,this.y-=this.speedY,this.size*=.95,this.size<.5&&(this.markForDeletion=!0)}},{key:"draw",value:function(t){}}]),e}());function a(t,e,i){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,n=t.x,h=t.y,o=t.x+t.width,a=t.y+t.height,c=n+r,l=h+s,u=o+r,f=a+s,d=e.x-i,g=e.y,v=e.x-i+e.width,y=e.y+e.height,p=l>g&&l<y||f>g&&f<y||g<f&&g>l||y<f&&y>l,m=u>d&&u<v||c>d&&c<v||c<d&&u>v,w=n>v&&c<v&&p,x=o<d&&u>d&&p,b=a<=g&&f>=g&&m,k=h>=y&&l<=y&&m;return{top:k,right:x,bottom:b,left:w,length:Number(k)+Number(x)+Number(b)+Number(w)}}function c(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function l(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function u(t,e,i){return e&&l(t.prototype,e),i&&l(t,i),t}function f(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function d(t){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},d(t)}function g(t,e){return g=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},g(t,e)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,r,s,n,h=d(t);if(e){var o=d(this).constructor;i=Reflect.construct(h,arguments,o)}else i=h.apply(this,arguments);return r=this,!(s=i)||"object"!=((n=s)&&"undefined"!=typeof Symbol&&n.constructor===Symbol?"symbol":typeof n)&&"function"!=typeof s?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(r):s}}var y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&g(t,e)}(i,t);var e=v(i);function i(){return c(this,i),e.apply(this,arguments)}return u(i,[{key:"update",value:function(t,e){this.frameTimer>this.frameInterval?(this.frameTimer=0,this.frameX++):this.frameTimer+=e;var i=this.game.player;t.hasKeys?(t.ArrowLeft||t.ArrowRight)&&(i.state="run",this.vx=10*(t.ArrowLeft?-1:1)*this.game.gameRatio,i.isReverse=!!t.ArrowLeft,i.isInAir||this.game.particles.push(new o(i.x+.5*i.width,i.y+i.height))):(i.state="idle",this.vx=0),t.ArrowDown?(i.state="sit",this.vx=0):t[" "]&&(i.state="roll",this.vx=15*(i.isReverse?-1:1)*this.game.gameRatio),t.b&&(i.state="attack"),t.ArrowUp&&!i.isInAir&&(this.vy-=Math.floor(i.maxJump),i.isInAir=!0),this.vy+=this.gravity*this.game.gameRatio;var r=this.game.getCurrentLevel();i.collision={top:!1,right:!1,bottom:!1,left:!1};for(var s=i.sprite.states[i.state].inset,n={width:i.width-20,height:i.height-s.top-s.bottom,x:i.x+10,y:i.y+s.top},h=0;h<r.platforms.length;h++){var c=a(n,r.platforms[h],r.current,this.vx,this.vy);i.collision={top:c.top||i.collision.top,bottom:c.bottom||i.collision.bottom,right:c.right||i.collision.right,left:c.left||i.collision.left},(c.top||c.bottom)&&(c.bottom&&(i.isInAir=!1),this.vy=0),(c.left||c.right)&&(this.vx=0)}this.vy&&"roll"!==i.state&&(i.state=-this.vy>i.maxJump/2-20?"jump":"fall"),i.y+=this.vy,i.x+i.width/2+this.vx>=this.game.canvas.width/2&&this.vx>0?r.current+this.vx+i.width+this.game.canvas.width>=r.end?i.x+this.vx+i.width>=this.game.canvas.width?(i.x=this.game.canvas.width-i.width,this.vx=0):(i.x+=this.vx,this.vx=0):this.game.getCurrentLevel().current+=this.vx:i.x+this.vx<=r.start+100?r.current<=0?(i.x=i.x+this.vx>0?i.x+this.vx:0,this.vx=0):(i.x=100,this.game.getCurrentLevel().current+=this.vx):(i.x+=this.vx,this.vx=0)}}]),i}(function(){function t(e,i){c(this,t),f(this,"game",void 0),f(this,"type",void 0),f(this,"vx",0),f(this,"vy",0),f(this,"vz",0),f(this,"gravity",1),f(this,"fps",30),f(this,"frameInterval",1e3/this.fps),f(this,"frameTimer",0),f(this,"frameX",0),this.game=e,this.type=i}return u(t,[{key:"update",value:function(t,e){}}]),t}());function p(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function m(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var w=function(){function t(e,i){var r,s,n,h,o;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),m(this,"state","idle"),m(this,"x",0),m(this,"y",0),m(this,"sprite",void 0),m(this,"width",void 0),m(this,"height",void 0),m(this,"ratio",void 0),m(this,"isReverse",!1),m(this,"maxJump",void 0),m(this,"isInAir",void 0),m(this,"collision",{top:!1,right:!1,bottom:!1,left:!1}),this.sprite=(r=e.src,s=e.width,n=e.height,h=e.states,(o=new Image).src=r,{width:s,height:n,image:o,states:Object.keys(h).reduce((function(t,e){var i=e;return t[i]={x:Array(h[i].frames).fill(s).map((function(t,e){return t*e})),y:h[i].row*n,inset:h[i].inset},t}),{})}),this.ratio=this.sprite.height/this.sprite.width,this.height=this.calculateHeight(i),this.width=this.calcultateWidth(),this.x=1,this.y=0,this.maxJump=this.calculateMaxJump(i),this.isInAir=!0}var e,i;return e=t,(i=[{key:"calculateHeight",value:function(t){return 174.3333*t}},{key:"calcultateWidth",value:function(){return this.height*this.ratio}},{key:"calculateMaxJump",value:function(t){for(var e=0,i=0;i<=360;)i+=++e;return e*t}},{key:"resize",value:function(t,e){this.height=this.calculateHeight(e),this.width=this.calcultateWidth(),this.maxJump=this.calculateMaxJump(e),this.y=this.y/t*e,this.x=this.x/t*e}},{key:"draw",value:function(t,e,i){var r=this.sprite.states[this.state],s=r.x[e%r.x.length],n=r.y;i&&(t.strokeStyle="green",t.font="14px Mono",t.strokeStyle=this.collision.top?"red":"green",t.strokeRect(this.x+r.inset.left,this.y+r.inset.top,this.width-r.inset.left-r.inset.right,1),t.strokeStyle=this.collision.right?"red":"green",t.strokeRect(this.x+this.width-r.inset.right,this.y+r.inset.top,1,this.height-r.inset.top-r.inset.bottom),t.strokeStyle=this.collision.bottom?"red":"green",t.strokeRect(this.x+r.inset.left,this.y+this.height-r.inset.bottom,this.width-r.inset.left-r.inset.right,1),t.strokeStyle=this.collision.left?"red":"green",t.strokeRect(this.x+r.inset.left,this.y+r.inset.top,1,this.height-r.inset.top-r.inset.bottom),t.textAlign="right",t.strokeText("x:".concat(this.x.toFixed(2),",  y:").concat(this.y.toFixed(2)),this.x,this.y),t.textAlign="left",t.strokeText("x:".concat((this.x+this.width).toFixed(2),",  y:").concat(this.y.toFixed(2)),this.x+this.width,this.y),t.textAlign="right",t.strokeText("x:".concat(this.x.toFixed(2),",  y:").concat((this.y+this.height).toFixed(2)),this.x,this.y+this.height),t.textAlign="left",t.strokeText("x:".concat((this.x+this.width).toFixed(2),",  y:").concat((this.y+this.height).toFixed(2)),this.x+this.width,this.y+this.height)),this.isReverse?(t.save(),t.scale(-1,1),t.drawImage(this.sprite.image,s,n,this.sprite.width,this.sprite.height,-this.x-this.width,this.y,this.width,this.height),t.restore()):t.drawImage(this.sprite.image,s,n,this.sprite.width,this.sprite.height,this.x,this.y,this.width,this.height)}}])&&p(e.prototype,i),t}();function x(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var b={ArrowDown:!0,ArrowUp:!0,ArrowLeft:!0,ArrowRight:!0,b:!0," ":!0,hasKeys:!1};function k(t){return t in b}var R=function t(e){var i=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),x(this,"keys",{hasKeys:!1}),x(this,"length",0),window.addEventListener("keydown",(function(t){k(t.key)&&!i.keys[t.key]&&(t.preventDefault(),i.keys[t.key]=!0,i.length++,i.keys.hasKeys=!!i.length)})),window.addEventListener("keyup",(function(t){k(t.key)&&(t.preventDefault(),i.keys[t.key]=!1,i.length--,i.keys.hasKeys=!!i.length),"d"===t.key&&(e.debug=!e.debug)}))};function A(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function S(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var P=function(){function t(e,i,r){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),S(this,"image",void 0),S(this,"game",void 0),S(this,"speedModifer",void 0),S(this,"width",void 0),this.image=new Image,this.image.src=e,this.speedModifer=i,this.game=r,this.width=2400*this.game.gameRatio}var e,i;return e=t,i=[{key:"resize",value:function(){this.width=2400*this.game.gameRatio}},{key:"draw",value:function(t,e){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=-e*this.speedModifer%this.width,s=i;t.drawImage(this.image,r,s,this.width,this.game.canvas.height),t.drawImage(this.image,r+this.width,s,this.width,this.game.canvas.height),this.game.debug&&(t.strokeStyle="red",t.font="14px Mono",t.strokeRect(r,s,this.width,this.game.canvas.height),t.textAlign="center",t.strokeText("width:".concat(this.width.toFixed(2),",  height:").concat(this.game.canvas.height.toFixed(2)),r+this.width/2,s+this.game.canvas.height/2),t.strokeStyle="black",t.strokeRect(r+this.width+2,s,this.width-4,this.game.canvas.height),t.textAlign="center",t.strokeText("width:".concat(this.width.toFixed(2),",  height:").concat(this.game.canvas.height.toFixed(2)),r+this.width+this.width/2-this.game.canvas.width,s+this.game.canvas.height/2))}}],i&&A(e.prototype,i),t}();function O(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function F(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var T=function(){function t(e,i,r,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),F(this,"start",0),F(this,"end",0),F(this,"current",0),F(this,"type",void 0),F(this,"platforms",void 0),F(this,"backgrounds",void 0),F(this,"isStart",void 0),F(this,"game",void 0),this.game=s,this.type=e,this.isStart=!0,this.platforms=i,this.backgrounds=r,this.calculatePositions(1)}var e,i;return e=t,i=[{key:"calculatePositions",value:function(t){var e=this.current/t*this.game.gameRatio,i=0,r=0,s=!0,n=!1,h=void 0;try{for(var o,a=this.platforms[Symbol.iterator]();!(s=(o=a.next()).done);s=!0){var c=o.value;c.x<i&&(i=c.x),c.x+c.width>r&&(r=c.x+c.width)}}catch(t){n=!0,h=t}finally{try{s||null==a.return||a.return()}finally{if(n)throw h}}this.start=i,this.end=r,this.current=e||(this.isStart?this.start:this.end),this.end-this.game.canvas.width<this.current&&(this.current=this.end-this.game.canvas.width)}},{key:"draw",value:function(t,e){for(var i=0;i<this.backgrounds.length;i++)this.backgrounds[i].draw(t,this.current);for(var r=0;r<this.platforms.length;r++)this.platforms[r].draw(t,this.current,0);e.debug&&(t.strokeStyle="red",t.font="14px Mono",t.textAlign="left",t.strokeText("start:".concat(this.start),this.start-this.current,this.game.canvas.height/2),t.strokeText("current:".concat(this.current),0,this.game.canvas.height/2-20),t.textAlign="right",t.strokeText("end:".concat(this.current+e.canvas.width),this.end-(this.current+e.player.width+10),this.game.canvas.height/2))}},{key:"resize",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.game.gameRatio;this.platforms.forEach((function(t){return t.resize()})),this.backgrounds.forEach((function(t){return t.resize()})),this.calculatePositions(t)}}],i&&O(e.prototype,i),t}();function _(t,e,i,r,s,n,h){try{var o=t[n](h),a=o.value}catch(t){return void i(t)}o.done?e(a):Promise.resolve(a).then(r,s)}function L(t,e){return j.apply(this,arguments)}function j(){return(t=function(t,e){return function(t,e){var i,r,s,n,h={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return n={next:o(0),throw:o(1),return:o(2)},"function"==typeof Symbol&&(n[Symbol.iterator]=function(){return this}),n;function o(n){return function(o){return function(n){if(i)throw new TypeError("Generator is already executing.");for(;h;)try{if(i=1,r&&(s=2&n[0]?r.return:n[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,n[1])).done)return s;switch(r=0,s&&(n=[2&n[0],s.value]),n[0]){case 0:case 1:s=n;break;case 4:return h.label++,{value:n[1],done:!1};case 5:h.label++,r=n[1],n=[0];continue;case 7:n=h.ops.pop(),h.trys.pop();continue;default:if(!((s=(s=h.trys).length>0&&s[s.length-1])||6!==n[0]&&2!==n[0])){h=0;continue}if(3===n[0]&&(!s||n[1]>s[0]&&n[1]<s[3])){h.label=n[1];break}if(6===n[0]&&h.label<s[1]){h.label=s[1],s=n;break}if(s&&h.label<s[2]){h.label=s[2],h.ops.push(n);break}s[2]&&h.ops.pop(),h.trys.pop();continue}n=e.call(t,h)}catch(t){n=[6,t],r=0}finally{i=s=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,o])}}}(this,(function(i){return[2,new Promise((function(i,r){var s=new Image;s.onload=function(){var r=document.createElement("canvas"),n=r.getContext("2d"),h=s.width*e,o=s.height*e;r.width=h,r.height=o,n.drawImage(s,0,0,h,o),i({name:t.name,image:r,src:t.src})},s.onerror=function(){return r()},s.src=t.src}))]}))},j=function(){var e=this,i=arguments;return new Promise((function(r,s){var n=t.apply(e,i);function h(t){_(n,r,s,h,o,"next",t)}function o(t){_(n,r,s,h,o,"throw",t)}h(void 0)}))}).apply(this,arguments);var t}function C(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function E(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var z=function(){function t(e,i,r,s,n,h){var o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"repeat-x";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),E(this,"_width",void 0),E(this,"_height",void 0),E(this,"_x",void 0),E(this,"_y",void 0),E(this,"x",void 0),E(this,"y",void 0),E(this,"width",void 0),E(this,"height",void 0),E(this,"game",void 0),E(this,"fillStyle","#0000"),E(this,"imageSrc",void 0),E(this,"repeat",void 0),E(this,"stretch",!1),this._x=e,this._y=i,this._width=r,this._height=s,this.x=this._x*n.gameRatio,this.y=this._y*n.gameRatio,this.width=this._width*n.gameRatio,this.height=this._height*n.gameRatio,this.game=n,this.imageSrc=h,this.repeat=o,this.createPattern()}var e,i;return e=t,(i=[{key:"draw",value:function(t,e,i){"string"==typeof this.fillStyle?(t.fillStyle=this.fillStyle,t.fillRect(this.x-e,this.y-i,this.width,this.height)):(t.save(),t.fillStyle=this.fillStyle,t.translate(this.x-e,this.y-i),t.fillRect(0,0,this.width,this.height),t.restore()),this.game.debug&&(t.strokeStyle="orange",t.font="14px Mono",t.strokeRect(this.x-e,this.y-i,this.width,this.height),t.textAlign="left",t.strokeText("x:".concat((this.x-e).toFixed(2),",  y:").concat((this.y-i).toFixed(2)),this.x-e,this.y-i),t.textAlign="right",t.strokeText("x:".concat((this.x+this.width-e).toFixed(2),",  y:").concat((this.y-i).toFixed(2)),this.x+this.width-e,this.y-i),t.textAlign="left",t.strokeText("x:".concat((this.x-e).toFixed(2),",  y:").concat((this.y+this.height-i).toFixed(2)),this.x-e,this.y+this.height-i),t.textAlign="right",t.strokeText("x:".concat((this.x+this.width-e).toFixed(2),",  y:").concat((this.y+this.height-i).toFixed(2)),this.x+this.width-e,this.y+this.height-i),t.textAlign="center",t.strokeText("width:".concat(this.width.toFixed(2),",  height:").concat(this.height.toFixed(2)),this.x+this.width/2-e,this.y+this.height/2-i))}},{key:"createPattern",value:function(){var t=this;L({name:"ground",src:this.imageSrc},this.game.gameRatio).then((function(e){var i;t.fillStyle=(null===(i=t.game.canvas.getContext("2d"))||void 0===i?void 0:i.createPattern(e.image,t.repeat))||"#0000"}))}},{key:"resize",value:function(){this.x=this._x*this.game.gameRatio,this.y=this._y*this.game.gameRatio,this.width=this._width*this.game.gameRatio,this.height=this._height*this.game.gameRatio,this.createPattern()}}])&&C(e.prototype,i),t}(),I="level1/ground.png",M="level2/ground.png",H="level3/ground.png",D=[{name:"level1",type:"2dScroller",platforms:[{x:0,y:599,width:500,height:121,src:I},{x:800,y:599,width:1400,height:121,src:I},{x:3050,y:599,width:4e3,height:121,src:I},{x:1e3,y:299,width:200,height:300,src:I,repeat:"repeat"},{x:4440,y:300,width:100,height:50,src:I},{x:4700,y:200,width:300,height:50,src:I},{x:5300,y:100,width:300,height:50,src:I},{x:5800,y:50,width:400,height:50,src:I},{x:1600,y:200,width:300,height:50,src:I},{x:2100,y:100,width:300,height:50,src:I},{x:3e3,y:150,width:300,height:50,src:I},{x:3300,y:300,width:300,height:50,src:I}],backgrounds:Array(4).fill(0).map((function(t,e){return{speed:.2*(e+1),src:"level1/layer-".concat(e+1,".png")}}))},{name:"level2",type:"2dScroller",platforms:[{x:0,y:599,width:800,height:121,src:M},{x:1100,y:599,width:1400,height:121,src:M},{x:3050,y:599,width:4e3,height:121,src:M},{x:1e3,y:299,width:200,height:300,src:M,repeat:"repeat"},{x:1600,y:300,width:300,height:50,src:M},{x:2100,y:200,width:300,height:50,src:M},{x:3e3,y:250,width:300,height:50,src:M},{x:3300,y:400,width:300,height:50,src:M}],backgrounds:Array(4).fill(0).map((function(t,e){return{speed:.2*(e+1),src:"level2/layer-".concat(e+1,".png")}}))},{name:"level3",type:"2dScroller",platforms:[{x:0,y:599,width:800,height:121,src:H},{x:1100,y:599,width:1400,height:121,src:H},{x:3050,y:599,width:4e3,height:121,src:H},{x:1e3,y:299,width:200,height:300,src:H,repeat:"repeat"},{x:1600,y:300,width:300,height:50,src:H},{x:2100,y:200,width:300,height:50,src:H},{x:3e3,y:250,width:300,height:50,src:H},{x:3300,y:400,width:300,height:50,src:H}],backgrounds:Array(4).fill(0).map((function(t,e){return{speed:.2*(e+1),src:"level3/layer-".concat(e+1,".png")}}))}],G=[{name:"dog",src:"players/shadow_dog.png",width:575,height:523,states:{idle:{row:0,frames:7,inset:{top:20,right:10,bottom:0,left:10}},jump:{row:1,frames:7,inset:{top:20,right:10,bottom:0,left:10}},fall:{row:2,frames:7,inset:{top:20,right:10,bottom:0,left:10}},run:{row:3,frames:9,inset:{top:20,right:10,bottom:0,left:10}},dizzy:{row:4,frames:11,inset:{top:20,right:10,bottom:0,left:10}},sit:{row:5,frames:5,inset:{top:50,right:10,bottom:0,left:10}},roll:{row:6,frames:7,inset:{top:80,right:40,bottom:0,left:40}},attack:{row:7,frames:7,inset:{top:20,right:0,bottom:0,left:0}},ko:{row:8,frames:12,inset:{top:20,right:10,bottom:0,left:10}},getHit:{row:9,frames:4,inset:{top:20,right:10,bottom:0,left:10}}}}];function J(t,e){for(var i=0;i<e.length;i++){var r=e[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function X(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var B=function(){function t(e,i){var r,s=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),X(this,"gameFrames",0),X(this,"player",void 0),X(this,"particles",[]),X(this,"inputHandler",void 0),X(this,"controller",void 0),X(this,"canvas",void 0),X(this,"gameRatio",1),X(this,"levels",void 0),X(this,"currentLevel",void 0),X(this,"debug",!1),this.canvas=e,this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.gameRatio=this.canvas.height/720,this.inputHandler=new R(this),this.levels=(r=this,D.map((function(t){return new T(t.type,t.platforms.map((function(t){return new z(t.x,t.y,t.width,t.height,r,t.src,t.repeat)})),t.backgrounds.map((function(t){return new P(t.src,t.speed,r)})),r)}))),this.currentLevel=0,this.controller=this.getGameController(this.getCurrentLevel()),this.player=new w(G[0],this.gameRatio),this.particles=[],this.resizeGame(),window.addEventListener("resize",function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var r=arguments.length,s=new Array(r),n=0;n<r;n++)s[n]=arguments[n];var h=this;clearTimeout(e),e=setTimeout((function(){return t.apply(h,s)}),i)}}((function(){s.resizeGame()}),300))}var e,i;return e=t,(i=[{key:"getCurrentLevel",value:function(){return this.levels[this.currentLevel]}},{key:"getGameController",value:function(t){var e;if(t.type===(null===(e=this.controller)||void 0===e?void 0:e.type))return this.controller;if("2dScroller"===t.type)return new y(this,t.type);throw new Error("Unsupported game type")}},{key:"resetAtStart",value:function(){this.player.x=1;var t=this.getCurrentLevel();t.current=0,t.isStart=!0,this.particles=[]}},{key:"resetAtEnd",value:function(){var t=this.getCurrentLevel();t.current=t.end-this.canvas.width-this.player.width,this.player.x=this.canvas.width-this.player.width-1,t.isStart=!1,this.particles=[]}},{key:"animate",value:function(t,e){this.controller.update(this.inputHandler.keys,e);var i=this.getCurrentLevel();i.draw(t,this),this.player.draw(t,this.controller.frameX,this.debug);for(var r=0;r<this.particles.length;r++)this.particles[r].update(this.controller.vx),this.particles[r].markForDeletion?this.particles=this.particles.splice(r,0):this.particles[r].draw(t);this.player.y>this.canvas.height&&(this.player.y=1,i.isStart?this.resetAtStart():this.resetAtEnd()),this.player.x>=this.canvas.width-this.player.width?(this.currentLevel=(this.currentLevel+1)%this.levels.length,this.getCurrentLevel().resize(),this.resetAtStart(),this.controller=this.getGameController(this.getCurrentLevel())):this.player.x<=0&&(this.currentLevel=Math.abs((this.currentLevel-1<0?this.levels.length-1:this.currentLevel-1)%this.levels.length),this.getCurrentLevel().resize(),this.resetAtEnd(),this.controller=this.getGameController(this.getCurrentLevel())),t.font="purple",t.textAlign="right",t.strokeText("level:".concat(this.currentLevel+1),this.canvas.width-20,20),this.debug&&(t.textAlign="left",t.strokeText("fps:".concat((1e3/e).toFixed(2),",level:").concat(this.currentLevel,", vx:").concat(this.controller.vx.toFixed(),", vy: ").concat(this.controller.vy.toFixed(),", gravity:").concat((this.controller.gravity*this.gameRatio).toFixed(2),", gameRatio:").concat(this.gameRatio.toFixed(2)),20,20)),this.gameFrames++}},{key:"resizeGame",value:function(){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight;var t=this.gameRatio;this.gameRatio=this.canvas.height/720,t!==this.gameRatio&&(this.player.resize(t,this.gameRatio),this.getCurrentLevel().resize(t))}}])&&J(e.prototype,i),t}();window.addEventListener("load",(function(){var t=document.getElementById("canvas1"),e=t.getContext("2d"),i=new B(t,e),r=0;!function s(n){var h=n-r;r=n,e.clearRect(0,0,t.width,t.height),i.animate(e,h),requestAnimationFrame(s)}(r)}))})();