(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function i(t,i,s){return i&&e(t.prototype,i),s&&e(t,s),t}function s(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}function h(t){return h=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},h(t)}function r(t,e){return r=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},r(t,e)}function a(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var i,s,r,a,n=h(t);if(e){var o=h(this).constructor;i=Reflect.construct(n,arguments,o)}else i=n.apply(this,arguments);return s=this,!(r=i)||"object"!=((a=r)&&"undefined"!=typeof Symbol&&a.constructor===Symbol?"symbol":typeof a)&&"function"!=typeof r?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(s):r}}var n=function(e){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&r(t,e)}(h,e);var s=a(h);function h(e,i,r){return t(this,h),s.call(this,e,i+(60*Math.random()-30),r,Math.random(),Math.random(),"rgba(0,0,0,0.2)",10*Math.random()+10)}return i(h,[{key:"draw",value:function(t){t.beginPath(),t.arc(this.x,this.y,this.size,0,2*Math.PI),t.fillStyle=this.color,t.fill()}}]),h}(function(){function e(i,h,r,a,n,o,c){t(this,e),s(this,"game",void 0),s(this,"markForDeletion",void 0),s(this,"x",void 0),s(this,"y",void 0),s(this,"speedX",void 0),s(this,"speedY",void 0),s(this,"color",void 0),s(this,"size",void 0),this.game=i,this.x=h,this.y=r,this.speedX=a,this.speedY=n,this.color=o,this.size=c,this.markForDeletion=!1}return i(e,[{key:"update",value:function(t){this.x-=this.speedX+this.game.player.speed,this.y-=this.speedY,this.size*=.95,this.size<.5&&(this.markForDeletion=!0)}},{key:"draw",value:function(t){}}]),e}());function o(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function c(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var l,u,d=("shadow_dog.png",575,523,l={idle:{row:0,frames:7},jump:{row:1,frames:7},fall:{row:2,frames:7},run:{row:3,frames:9},dizzy:{row:4,frames:11},sit:{row:5,frames:5},roll:{row:6,frames:7},bite:{row:7,frames:7},ko:{row:8,frames:12},getHit:{row:9,frames:4}},(u=new Image).src="shadow_dog.png",{width:575,height:523,image:u,states:Object.keys(l).reduce((function(t,e){var i=e;return t[i]={x:Array(l[i].frames).fill(575).map((function(t,e){return t*e})),y:523*l[i].row},t}),{})}),g=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),c(this,"state","idle"),c(this,"x",0),c(this,"y",0),c(this,"vy",0),c(this,"vx",0),c(this,"spriteX",0),c(this,"spriteY",0),c(this,"width",void 0),c(this,"height",void 0),c(this,"ratio",void 0),c(this,"weight",1),c(this,"speed",0),c(this,"isReverse",!1),c(this,"game",void 0),c(this,"maxJump",void 0),c(this,"fps",void 0),c(this,"frameInterval",void 0),c(this,"frameTimer",void 0),c(this,"frameX",void 0),c(this,"isInAir",void 0),this.game=e,this.ratio=d.height/d.width,this.height=this.calculateHeight(),this.width=this.calcultateWidth(),this.x=1,this.y=0,this.vy=0,this.vx=0,this.weight=1,this.maxJump=this.calculateMaxJump(),this.fps=30,this.frameInterval=1e3/this.fps,this.frameTimer=0,this.frameX=0,this.isInAir=!0}var e,i;return e=t,(i=[{key:"calculateHeight",value:function(){return 174.3333*this.game.gameRatio}},{key:"calcultateWidth",value:function(){return this.height*this.ratio}},{key:"calculateMaxJump",value:function(){for(var t=0,e=0;e<=360;)e+=++t;return t*this.game.gameRatio}},{key:"resize",value:function(t){this.height=this.calculateHeight(),this.width=this.calcultateWidth(),this.maxJump=this.calculateMaxJump(),this.y=this.y/t*this.game.gameRatio,this.x=this.x/t*this.game.gameRatio}},{key:"update",value:function(t,e){var i=d.states[this.state];this.frameTimer>this.frameInterval?(this.frameTimer=0,this.frameX++):this.frameTimer+=e,this.spriteX=i.x[this.frameX%i.x.length],this.spriteY=i.y,t.hasKeys||(this.state="idle",this.vx=0),t.ArrowLeft?(this.state="run",this.vx=-10*this.game.gameRatio,this.isReverse=!0,this.isInAir||this.game.particles.push(new n(this.game,this.x+.5*this.width,this.y+this.height))):t.ArrowRight?(this.state="run",this.vx=10*this.game.gameRatio,this.isReverse=!1,this.isInAir||this.game.particles.push(new n(this.game,this.x+this.width/2,this.y+this.height))):t.ArrowDown&&(this.state="sit",this.vx=0),t[" "]&&(this.state="roll",this.isReverse?this.vx=-15*this.game.gameRatio:this.vx=15*this.game.gameRatio),t.b&&(this.state="bite"),t.ArrowUp&&!this.isInAir&&(this.vy-=Math.floor(this.maxJump),this.isInAir=!0),this.vy+=this.weight*this.game.gameRatio;for(var s,h,r,a,o,c,l,u,g,v,f,y,m,p,w,x,b,k,R,A,F,T,P,S,_=this.game.getCurrentLevel().platforms,L=0;L<_.length;L++){var M=(s=this,h=_[L],void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,l=s.x,u=s.y,g=s.x+s.width,v=s.y+s.height,f=null!==(o=null===(r=s)||void 0===r?void 0:r.vy)&&void 0!==o?o:0,m=l+(y=null!==(c=null===(a=s)||void 0===a?void 0:a.vx)&&void 0!==c?c:0),p=u+f,w=g+y,x=v+f,b=h.x,k=h.y,R=h.x+h.width,{top:S=u>=(A=h.y+h.height)&&p<=A&&(w>=b&&w<=R||m>=b&&m<=R||m<=b&&w>=R),right:T=g<=b&&w>=b&&(p>=k&&p<=A||x>=k&&x<=A),bottom:P=v<=k&&x>=k&&(w>=b&&w<=R||m>=b&&m<=R||m<=b&&w>=R),left:F=l>=R&&m<=R&&(p>=k&&p<=A||x>=k&&x<=A),length:Number(S)+Number(T)+Number(P)+Number(F)});(M.top||M.bottom)&&(M.bottom&&(this.isInAir=!1),this.vy=0),(M.left||M.right)&&(this.vx=0)}this.vy&&"roll"!==this.state&&(this.state=-this.vy>this.maxJump/2-20?"jump":"fall"),this.y+=this.vy;var O=this.game.getCurrentLevel();this.x+this.width/2+this.vx>=this.game.canvas.width/2&&this.vx>0?O.current+this.vx+this.width+this.game.canvas.width>=O.end&&(this.x+this.vx+this.width>=this.game.canvas.width?(this.x=this.game.canvas.width-this.width,this.vx=0):(this.x+=this.vx,this.vx=0)):this.x+this.vx<=O.start+100?O.current<=0?(this.x=this.x+this.vx>0?this.x+this.vx:0,this.vx=0):this.x=100:(this.x+=this.vx,this.vx=0)}},{key:"draw",value:function(t){this.game.debug&&(t.strokeStyle="red",t.font="14px Mono",t.strokeRect(this.x,this.y,this.width,this.height),t.textAlign="right",t.strokeText("x:".concat(this.x.toFixed(2),",  y:").concat(this.y.toFixed(2)),this.x,this.y),t.textAlign="left",t.strokeText("x:".concat((this.x+this.width).toFixed(2),",  y:").concat(this.y.toFixed(2)),this.x+this.width,this.y),t.textAlign="right",t.strokeText("x:".concat(this.x.toFixed(2),",  y:").concat((this.y+this.height).toFixed(2)),this.x,this.y+this.height),t.textAlign="left",t.strokeText("x:".concat((this.x+this.width).toFixed(2),",  y:").concat((this.y+this.height).toFixed(2)),this.x+this.width,this.y+this.height)),this.isReverse?(t.save(),t.scale(-1,1),t.drawImage(d.image,this.spriteX,this.spriteY,d.width,d.height,-this.x-this.width,this.y,this.width,this.height),t.restore()):t.drawImage(d.image,this.spriteX,this.spriteY,d.width,d.height,this.x,this.y,this.width,this.height)}}])&&o(e.prototype,i),t}();function v(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var f={ArrowDown:!0,ArrowUp:!0,ArrowLeft:!0,ArrowRight:!0,b:!0," ":!0,hasKeys:!1};function y(t){return t in f}var m=function t(){var e=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),v(this,"keys",{hasKeys:!1}),v(this,"length",0),window.addEventListener("keydown",(function(t){t.preventDefault(),y(t.key)&&!e.keys[t.key]&&(e.keys[t.key]=!0,e.length++,e.keys.hasKeys=!!e.length)})),window.addEventListener("keyup",(function(t){t.preventDefault(),y(t.key)&&(e.keys[t.key]=!1,e.length--,e.keys.hasKeys=!!e.length)}))};function p(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function w(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var x=function(){function t(e,i,s){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),w(this,"x",void 0),w(this,"y",void 0),w(this,"image",void 0),w(this,"game",void 0),w(this,"speedModifer",void 0),w(this,"width",void 0),this.x=0,this.y=0,this.image=new Image,this.image.src=e,this.speedModifer=i,this.game=s,this.width=2400*this.game.gameRatio,this.x=-this.game.canvas.width}var e,i;return e=t,(i=[{key:"resize",value:function(t){var e=this.width;this.width=2400*this.game.gameRatio,this.x=this.x/e*this.width}},{key:"update",value:function(){this.x=this.x-this.game.player.vx*this.speedModifer,this.x<=-this.width+this.game.canvas.width&&(this.x=this.game.canvas.width),this.x>this.game.canvas.width&&(this.x=-this.width+this.game.canvas.width)}},{key:"draw",value:function(t){t.drawImage(this.image,this.x-this.game.canvas.width,this.y,this.width,this.game.canvas.height),t.drawImage(this.image,this.x+this.width-this.game.canvas.width,this.y,this.width,this.game.canvas.height),this.game.debug&&.4===this.speedModifer&&(Math.floor(100*this.speedModifer),Math.floor(200*this.speedModifer),Math.floor(255*this.speedModifer),t.strokeStyle="red",t.font="14px Mono",t.strokeRect(this.x-this.game.canvas.width,this.y,this.width,this.game.canvas.height),t.textAlign="center",t.strokeText("width:".concat(this.width.toFixed(2),",  height:").concat(this.game.canvas.height.toFixed(2)),this.x+this.width/2,this.y+this.game.canvas.height/2),t.strokeStyle="black",t.strokeRect(this.x+this.width-this.game.canvas.width+2,this.y,this.width-4,this.game.canvas.height),t.textAlign="center",t.strokeText("width:".concat(this.width.toFixed(2),",  height:").concat(this.game.canvas.height.toFixed(2)),this.x+this.width+this.width/2-this.game.canvas.width,this.y+this.game.canvas.height/2))}}])&&p(e.prototype,i),t}();function b(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function k(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var R=function(){function t(e,i,s){var h=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),k(this,"start",0),k(this,"end",0),k(this,"current",0),k(this,"platforms",void 0),k(this,"backgrounds",void 0),k(this,"isStart",void 0),k(this,"game",void 0),this.game=s,this.isStart=h,this.platforms=e,this.backgrounds=i,this.calculatePositions(1)}var e,i;return e=t,(i=[{key:"calculatePositions",value:function(t){var e=this.current/t*this.game.gameRatio,i=0,s=0,h=!0,r=!1,a=void 0;try{for(var n,o=this.platforms[Symbol.iterator]();!(h=(n=o.next()).done);h=!0){var c=n.value;c.x+e<i&&(i=c.x+e),c.x+e+c.width>s&&(s=c.x+e+c.width)}}catch(t){r=!0,a=t}finally{try{h||null==o.return||o.return()}finally{if(r)throw a}}this.start=i,this.end=s,this.current=e||(this.isStart?this.start:this.end)}},{key:"update",value:function(t){this.current+=t;for(var e=0;e<this.backgrounds.length;e++)this.backgrounds[e].update();for(var i=0;i<this.platforms.length;i++)this.platforms[i].update()}},{key:"draw",value:function(t,e){for(var i=0;i<this.backgrounds.length;i++)this.backgrounds[i].draw(t);for(var s=0;s<this.platforms.length;s++)this.platforms[s].draw(t);e.debug&&(t.strokeStyle="red",t.font="14px Mono",t.textAlign="left",t.strokeText("start:".concat(this.start),this.start-this.current,450),t.strokeText("current:".concat(this.current),0,500),t.textAlign="right",t.strokeText("end:".concat(this.current+e.canvas.width),this.end-(this.current+e.player.width+10),450))}},{key:"resize",value:function(t){this.platforms.forEach((function(e){return e.resize(t)})),this.backgrounds.forEach((function(e){return e.resize(t)})),this.calculatePositions(t)}}])&&b(e.prototype,i),t}();function A(t,e,i,s,h,r,a){try{var n=t[r](a),o=n.value}catch(t){return void i(t)}n.done?e(o):Promise.resolve(o).then(s,h)}function F(){return t=function(t,e){return function(t,e){var i,s,h,r,a={label:0,sent:function(){if(1&h[0])throw h[1];return h[1]},trys:[],ops:[]};return r={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(r[Symbol.iterator]=function(){return this}),r;function n(r){return function(n){return function(r){if(i)throw new TypeError("Generator is already executing.");for(;a;)try{if(i=1,s&&(h=2&r[0]?s.return:r[0]?s.throw||((h=s.return)&&h.call(s),0):s.next)&&!(h=h.call(s,r[1])).done)return h;switch(s=0,h&&(r=[2&r[0],h.value]),r[0]){case 0:case 1:h=r;break;case 4:return a.label++,{value:r[1],done:!1};case 5:a.label++,s=r[1],r=[0];continue;case 7:r=a.ops.pop(),a.trys.pop();continue;default:if(!((h=(h=a.trys).length>0&&h[h.length-1])||6!==r[0]&&2!==r[0])){a=0;continue}if(3===r[0]&&(!h||r[1]>h[0]&&r[1]<h[3])){a.label=r[1];break}if(6===r[0]&&a.label<h[1]){a.label=h[1],h=r;break}if(h&&a.label<h[2]){a.label=h[2],a.ops.push(r);break}h[2]&&a.ops.pop(),a.trys.pop();continue}r=e.call(t,a)}catch(t){r=[6,t],s=0}finally{i=h=0}if(5&r[0])throw r[1];return{value:r[0]?r[1]:void 0,done:!0}}([r,n])}}}(this,(function(i){return[2,new Promise((function(i,s){var h=new Image;h.onload=function(){var s=document.createElement("canvas"),r=s.getContext("2d"),a=h.width*e,n=h.height*e;s.width=a,s.height=n,r.drawImage(h,0,0,a,n),i({name:t.name,image:s,src:t.src})},h.onerror=function(){return s()},h.src=t.src}))]}))},F=function(){var e=this,i=arguments;return new Promise((function(s,h){var r=t.apply(e,i);function a(t){A(r,s,h,a,n,"next",t)}function n(t){A(r,s,h,a,n,"throw",t)}a(void 0)}))},F.apply(this,arguments);var t}function T(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function P(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var S=function(){function t(e,i,s,h,r,a){var n=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"repeat-x";!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),P(this,"_width",void 0),P(this,"_height",void 0),P(this,"_x",void 0),P(this,"_y",void 0),P(this,"x",void 0),P(this,"y",void 0),P(this,"width",void 0),P(this,"height",void 0),P(this,"game",void 0),P(this,"fillStyle","#0000"),P(this,"imageSrc",void 0),P(this,"repeat",void 0),P(this,"stretch",!1),this._x=e,this._y=i,this._width=s,this._height=h,this.x=this._x*r.gameRatio,this.y=this._y*r.gameRatio,this.width=this._width*r.gameRatio,this.height=this._height*r.gameRatio,this.game=r,this.imageSrc=a,this.repeat=n,this.createPattern()}var e,i;return e=t,i=[{key:"update",value:function(){this.x-=this.game.player.vx}},{key:"draw",value:function(t){"string"==typeof this.fillStyle?(t.fillStyle=this.fillStyle,t.fillRect(this.x,this.y,this.width,this.height)):(t.save(),t.fillStyle=this.fillStyle,t.translate(this.x,this.y),t.fillRect(0,0,this.width,this.height),t.restore()),this.game.debug&&(t.strokeStyle="orange",t.font="14px Mono",t.strokeRect(this.x,this.y,this.width,this.height),t.textAlign="left",t.strokeText("x:".concat(this.x.toFixed(2),",  y:").concat(this.y.toFixed(2)),this.x,this.y),t.textAlign="right",t.strokeText("x:".concat((this.x+this.width).toFixed(2),",  y:").concat(this.y.toFixed(2)),this.x+this.width,this.y),t.textAlign="left",t.strokeText("x:".concat(this.x.toFixed(2),",  y:").concat((this.y+this.height).toFixed(2)),this.x,this.y+this.height),t.textAlign="right",t.strokeText("x:".concat((this.x+this.width).toFixed(2),",  y:").concat((this.y+this.height).toFixed(2)),this.x+this.width,this.y+this.height),t.textAlign="center",t.strokeText("width:".concat(this.width.toFixed(2),",  height:").concat(this.height.toFixed(2)),this.x+this.width/2,this.y+this.height/2))}},{key:"createPattern",value:function(){var t=this;(function(t,e){return F.apply(this,arguments)})({name:"ground",src:this.imageSrc},this.game.gameRatio).then((function(e){var i;t.fillStyle=(null===(i=t.game.canvas.getContext("2d"))||void 0===i?void 0:i.createPattern(e.image,t.repeat))||"#0000"}))}},{key:"reset",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"start";this.x=this._x*this.game.gameRatio,"end"===t&&(this.x-=this.game.getCurrentLevel().current)}},{key:"resize",value:function(t){this.x=this.x/t*this.game.gameRatio,this.y=this.y/t*this.game.gameRatio,this.width=this._width*this.game.gameRatio,this.height=this._height*this.game.gameRatio,this.createPattern()}}],i&&T(e.prototype,i),t}(),_="ground.png",L="level-1-ground-2.png",M="level-2-ground.png",O=[{name:"level1",platforms:[{x:0,y:599,width:500,height:121,src:_},{x:800,y:599,width:1400,height:121,src:_},{x:3050,y:599,width:4e3,height:121,src:_},{x:1e3,y:299,width:200,height:300,src:_,repeat:"repeat"},{x:1600,y:200,width:300,height:50,src:_},{x:2100,y:100,width:300,height:50,src:_},{x:3e3,y:150,width:300,height:50,src:_},{x:3300,y:300,width:300,height:50,src:_}],backgrounds:[{speed:.2,src:"layer-1.png"},{speed:.4,src:"layer-2.png"},{speed:.6,src:"layer-3.png"},{speed:.8,src:"layer-4.png"}]},{name:"level2",platforms:[{x:0,y:599,width:800,height:121,src:M},{x:1100,y:599,width:1400,height:121,src:M},{x:3050,y:599,width:4e3,height:121,src:M},{x:1e3,y:299,width:200,height:300,src:M,repeat:"repeat"},{x:1600,y:300,width:300,height:50,src:M},{x:2100,y:200,width:300,height:50,src:M},{x:3e3,y:250,width:300,height:50,src:M},{x:3300,y:400,width:300,height:50,src:M}],backgrounds:[{speed:.2,src:"layer-1.png"},{speed:.4,src:"level-2-layer-2.png"},{speed:.6,src:"level-2-layer-3.png"},{speed:.8,src:"level-2-layer-4.png"}]},{name:"level3",platforms:[{x:0,y:599,width:800,height:121,src:L},{x:1100,y:599,width:1400,height:121,src:L},{x:3050,y:599,width:4e3,height:121,src:L},{x:1e3,y:299,width:200,height:300,src:L,repeat:"repeat"},{x:1600,y:300,width:300,height:50,src:L},{x:2100,y:200,width:300,height:50,src:L},{x:3e3,y:250,width:300,height:50,src:L},{x:3300,y:400,width:300,height:50,src:L}],backgrounds:[{speed:.2,src:"layer-1.png"},{speed:.4,src:"level-1-layer-3.png"},{speed:.6,src:"level-1-layer-2.png"},{speed:.8,src:"level-1-layer-4.png"}]}];function E(t,e){for(var i=0;i<e.length;i++){var s=e[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function j(t,e,i){return e in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var I=function(){function t(e,i){var s,h=this;!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),j(this,"gameFrames",0),j(this,"player",void 0),j(this,"particles",[]),j(this,"inputHandler",void 0),j(this,"canvas",void 0),j(this,"gameRatio",1),j(this,"levels",void 0),j(this,"currentLevel",void 0),j(this,"debug",!1),this.canvas=e,this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight,this.gameRatio=this.canvas.height/720,this.inputHandler=new m,this.levels=(s=this,O.map((function(t){return new R(t.platforms.map((function(t){return new S(t.x,t.y,t.width,t.height,s,t.src,t.repeat)})),t.backgrounds.map((function(t){return new x(t.src,t.speed,s)})),s)}))),this.currentLevel=0,this.player=new g(this),this.particles=[],this.resizeGame(i,!0),window.addEventListener("resize",function(t){var e,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:300;return function(){for(var s=arguments.length,h=new Array(s),r=0;r<s;r++)h[r]=arguments[r];var a=this;clearTimeout(e),e=setTimeout((function(){return t.apply(a,h)}),i)}}((function(){h.resizeGame(i)}),300))}var e,i;return e=t,(i=[{key:"getCurrentLevel",value:function(){return this.levels[this.currentLevel]}},{key:"resetAtStart",value:function(){this.player.x=1;var t=this.getCurrentLevel();t.platforms.forEach((function(t){return t.reset()})),t.current=0,t.calculatePositions(this.gameRatio),t.isStart=!0}},{key:"resetAtEnd",value:function(){var t=this.getCurrentLevel();this.player.x=this.canvas.width-this.player.width-1,t.calculatePositions(this.gameRatio),t.current=t.end-this.canvas.width,t.platforms.forEach((function(t){return t.reset("end")})),t.isStart=!1}},{key:"animate",value:function(t,e){this.player.update(this.inputHandler.keys,e);var i=this.getCurrentLevel();i.update(this.player.vx),i.draw(t,this),this.player.draw(t);for(var s=0;s<this.particles.length;s++)this.particles[s].update(e),this.particles[s].markForDeletion?this.particles=this.particles.splice(s,0):this.particles[s].draw(t);this.player.y>this.canvas.height&&(this.player.y=1,i.isStart?this.resetAtStart():this.resetAtEnd()),this.player.x>=this.canvas.width-this.player.width?(this.currentLevel=(this.currentLevel+1)%this.levels.length,this.resetAtStart()):this.player.x<=0&&(this.currentLevel=Math.abs((this.currentLevel-1<0?this.levels.length-1:this.currentLevel-1)%this.levels.length),this.resetAtEnd()),t.font="purple",t.textAlign="right",t.strokeText("level:".concat(this.currentLevel),this.canvas.width-20,20),this.debug&&(t.textAlign="left",t.strokeText("deltaTime:".concat(e.toFixed(2),",level:").concat(this.currentLevel,", vx:").concat(this.player.vx.toFixed(),", vy: ").concat(this.player.vy.toFixed(),", weight:").concat((this.player.weight*this.gameRatio).toFixed(2),", gameRatio:").concat(this.gameRatio.toFixed(2)),20,20)),this.gameFrames++}},{key:"resizeGame",value:function(t){this.canvas.width=window.innerWidth,this.canvas.height=window.innerHeight;var e=this.gameRatio;this.gameRatio=this.canvas.height/720,e!==this.gameRatio&&(this.player.resize(e),this.getCurrentLevel().resize(e))}}])&&E(e.prototype,i),t}();window.addEventListener("load",(function(){var t=document.getElementById("canvas1"),e=t.getContext("2d"),i=new I(t,e),s=0;!function h(r){var a=r-s;s=r,e.clearRect(0,0,t.width,t.height),i.animate(e,a),requestAnimationFrame(h)}(s)}))})();